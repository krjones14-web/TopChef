<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ğŸ³ Top Chef Fantasy League</title>
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,700;1,400&family=Crimson+Text:ital,wght@0,400;0,600;1,400&display=swap" rel="stylesheet">

<style>
  :root {
    --bg: #0c0908;
    --bg2: #110d0b;
    --bg3: #160f0c;
    --border: #2a1a12;
    --border2: #3a2418;
    --accent: #c8763a;
    --accent2: #e8a84a;
    --gold: #c8a84b;
    --text: #f0e0cc;
    --text2: #a08060;
    --text3: #5a4030;
    --red: #8b2a2a;
    --red2: #b03a3a;
    --green: #2a6a2a;
    --green2: #4a9a4a;
  }

  * { box-sizing: border-box; margin: 0; padding: 0; }

  body {
    background: var(--bg);
    color: var(--text);
    font-family: 'Crimson Text', Georgia, serif;
    font-size: 16px;
    min-height: 100vh;
  }

  /* â”€â”€â”€ SETUP SCREEN â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */

  /* â”€â”€â”€ MAIN APP â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  #app { display: none; }

  header {
    background: linear-gradient(135deg, #160a06 0%, #221208 50%, #160a06 100%);
    border-bottom: 1px solid var(--border2);
    padding: 18px 28px;
    display: flex; align-items: center; justify-content: space-between;
    position: sticky; top: 0; z-index: 100;
    box-shadow: 0 4px 40px rgba(0,0,0,0.4);
  }

  .logo-eyebrow { font-size: 10px; letter-spacing: 5px; color: var(--accent); text-transform: uppercase; margin-bottom: 2px; }
  .logo-title { font-family: 'Playfair Display', serif; font-size: 22px; font-weight: 400; color: var(--text); }
  .header-right { display: flex; flex-direction: column; align-items: flex-end; gap: 8px; }

  nav { display: flex; gap: 4px; flex-wrap: wrap; justify-content: flex-end; }

  nav button {
    padding: 6px 14px; background: transparent;
    border: 1px solid var(--border); color: var(--text3);
    cursor: pointer; border-radius: 4px;
    font-family: 'Crimson Text', serif; font-size: 13px; transition: all 0.2s;
  }
  nav button.active { background: var(--red); border-color: var(--red2); color: var(--text); }
  nav button:hover:not(.active) { border-color: var(--border2); color: var(--text2); }

  .sync-status { font-size: 10px; color: var(--text3); letter-spacing: 2px; text-transform: uppercase; }
  .sync-status.syncing { color: var(--accent); animation: pulse 1s infinite; }
  .sync-status.ok { color: #3a6a3a; }
  .sync-status.error { color: var(--red2); }

  @keyframes pulse { 0%,100%{opacity:1} 50%{opacity:0.4} }
  @keyframes fadeUp { from{opacity:0;transform:translateY(10px)} to{opacity:1;transform:translateY(0)} }
  @keyframes spin { from{transform:rotate(0deg)} to{transform:rotate(360deg)} }
  @keyframes shimmer { 0%{background-position:200% 0} 100%{background-position:-200% 0} }

  .container { max-width: 860px; margin: 0 auto; padding: 28px 20px; }
  .tab-content { display: none; }
  .tab-content.active { display: block; animation: fadeUp 0.3s ease; }

  .section-header { display: flex; align-items: flex-start; justify-content: space-between; margin-bottom: 22px; }
  .section-title { font-size: 11px; letter-spacing: 4px; color: var(--accent); text-transform: uppercase; margin-bottom: 3px; }
  .section-sub { font-size: 12px; color: var(--text3); }

  /* â”€â”€â”€ CARDS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .card { background: var(--bg2); border: 1px solid var(--border); border-radius: 8px; padding: 18px; margin-bottom: 10px; }
  .card.gold-border { border-color: #5a3a0a; background: linear-gradient(135deg, #130e02, #1a1203); }

  /* â”€â”€â”€ BUTTONS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .btn { padding: 8px 18px; background: var(--red); border: 1px solid var(--red2); color: var(--text); cursor: pointer; border-radius: 4px; font-family: 'Crimson Text', serif; font-size: 14px; transition: all 0.2s; white-space: nowrap; }
  .btn:hover { background: var(--red2); }
  .btn-ghost { padding: 8px 18px; background: transparent; border: 1px solid var(--border2); color: var(--text3); cursor: pointer; border-radius: 4px; font-family: 'Crimson Text', serif; font-size: 14px; transition: all 0.2s; white-space: nowrap; }
  .btn-ghost:hover { border-color: var(--accent); color: var(--text2); }
  .btn-sm { padding: 5px 12px; font-size: 12px; }
  .btn-icon { background: none; border: none; color: var(--text3); cursor: pointer; font-size: 16px; padding: 4px 8px; transition: color 0.2s; }
  .btn-icon:hover { color: var(--red2); }

  /* â”€â”€â”€ INPUTS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  input[type=text], textarea {
    padding: 9px 14px; background: var(--bg); border: 1px solid var(--border2);
    border-radius: 5px; color: var(--text);
    font-family: 'Crimson Text', serif; font-size: 15px; transition: border-color 0.2s;
  }
  input[type=text]:focus, textarea:focus { outline: none; border-color: var(--accent); }
  input[type=text]::placeholder, textarea::placeholder { color: var(--text3); }

  /* â”€â”€â”€ LEADERBOARD â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .player-row { display: flex; align-items: center; gap: 14px; padding: 16px 18px; background: var(--bg2); border: 1px solid var(--border); border-radius: 8px; margin-bottom: 10px; animation: fadeUp 0.3s ease; }
  .player-rank { font-size: 24px; width: 34px; text-align: center; flex-shrink: 0; }
  .player-info { flex: 1; min-width: 0; }
  .player-name { font-size: 17px; color: var(--text); margin-bottom: 2px; }
  .player-picks-preview { font-size: 11px; color: var(--text3); white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
  .player-score { text-align: right; flex-shrink: 0; }
  .score-num { font-family: 'Playfair Display', serif; font-size: 28px; line-height: 1; }
  .score-num.positive { color: var(--gold); }
  .score-num.negative { color: var(--red2); }
  .score-num.zero { color: var(--text3); }
  .score-label { font-size: 10px; color: var(--text3); letter-spacing: 2px; margin-top: 2px; }

  /* â”€â”€â”€ INLINE FORM â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .inline-form { background: var(--bg3); border: 1px solid var(--border2); border-radius: 8px; padding: 18px; margin-bottom: 16px; animation: fadeUp 0.2s ease; }
  .form-title { font-size: 12px; letter-spacing: 3px; color: var(--accent); text-transform: uppercase; margin-bottom: 14px; }
  .form-row { display: flex; gap: 10px; }
  .form-row input { flex: 1; }

  /* â”€â”€â”€ PICK CHIPS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .chips { display: flex; flex-wrap: wrap; gap: 7px; margin-top: 10px; }
  .chip { padding: 4px 13px; border-radius: 20px; border: 1px solid var(--border2); background: transparent; color: var(--text3); font-family: 'Crimson Text', serif; font-size: 13px; cursor: pointer; transition: all 0.15s; }
  .chip:hover { border-color: var(--accent); color: var(--text2); }
  .chip.selected { background: #3a1010; border-color: var(--red2); color: var(--text); }
  .chip.eliminated { color: #251515; border-color: #1a0f0f; text-decoration: line-through; cursor: default; }
  .pick-tag { display: inline-block; padding: 3px 11px; border-radius: 20px; background: #1f0c0c; border: 1px solid #3a1a1a; font-size: 12px; color: #c4906a; margin: 2px; }

  /* â”€â”€â”€ EPISODES â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .event-grid { display: flex; flex-wrap: wrap; gap: 6px; margin-top: 8px; }
  .event-btn { padding: 4px 11px; border-radius: 4px; border: 1px solid var(--border2); background: transparent; color: var(--text3); font-family: 'Crimson Text', serif; font-size: 12px; cursor: pointer; transition: all 0.15s; }
  .event-btn:hover { border-color: var(--accent); }
  .event-btn.active { background: #3a0f0f; border-color: var(--red2); color: var(--text); }
  .event-pts-pos { color: var(--green2); }
  .event-pts-neg { color: var(--red2); }
  .ep-chef-row { display: flex; align-items: flex-start; gap: 10px; margin-bottom: 12px; padding-bottom: 12px; border-bottom: 1px solid var(--border); }
  .ep-chef-row:last-child { border-bottom: none; margin-bottom: 0; }
  .ep-chef-name { color: var(--accent2); font-size: 13px; width: 80px; flex-shrink: 0; padding-top: 6px; }
  .ep-events-scroll { max-height: 340px; overflow-y: auto; padding-right: 4px; margin-top: 12px; }
  .event-tag { display: inline-block; padding: 2px 9px; border-radius: 20px; font-size: 11px; margin: 1px; }
  .event-tag.pos { background: #0a1f0a; border: 1px solid #154a15; color: var(--green2); }
  .event-tag.neg { background: #1f0a0a; border: 1px solid #4a1515; color: var(--red2); }
  
  
  
  
  
  
  
  
  
  
  
  
  .chip-check { font-size: 10px; }
  
  
  /* â”€â”€â”€ TEXT PANEL â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .text-panel {
    background: #0a140a;
    border: 1px solid #1a3a1a;
    border-radius: 8px;
    padding: 20px;
    margin-top: 20px;
    animation: fadeUp 0.3s ease;
  }
  .text-panel-header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 14px; }
  .text-badge { font-size: 10px; letter-spacing: 3px; color: var(--green2); text-transform: uppercase; background: #0f2a0f; border: 1px solid #1a4a1a; padding: 3px 10px; border-radius: 20px; }
  .text-preview {
    background: var(--bg);
    border: 1px solid var(--border);
    border-radius: 6px;
    padding: 16px;
    font-size: 14px;
    line-height: 1.8;
    color: var(--text2);
    white-space: pre-wrap;
    font-family: 'Crimson Text', serif;
    margin-bottom: 12px;
  }
  .copy-btn { display: flex; align-items: center; gap: 8px; padding: 10px 20px; background: #1a4a1a; border: 1px solid #2a6a2a; color: var(--green2); border-radius: 4px; cursor: pointer; font-family: 'Crimson Text', serif; font-size: 14px; transition: all 0.2s; }
  .copy-btn:hover { background: #2a6a2a; }
  .copy-btn.copied { background: #0f2a0f; color: #3a8a3a; }

  /* â”€â”€â”€ CHEFS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .chef-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(130px, 1fr)); gap: 10px; }
  .chef-card { background: var(--bg2); border: 1px solid var(--border); border-radius: 8px; padding: 16px 10px; text-align: center; transition: opacity 0.3s; }
  .chef-card.eliminated { opacity: 0.35; }
  .chef-emoji { font-size: 26px; margin-bottom: 6px; }
  .chef-name { font-size: 13px; color: var(--text); margin-bottom: 10px; }
  .chef-card.eliminated .chef-name { text-decoration: line-through; color: var(--text3); }

  /* â”€â”€â”€ LOADING â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  #loading-overlay { position: fixed; inset: 0; background: var(--bg); display: flex; align-items: center; justify-content: center; z-index: 999; flex-direction: column; gap: 16px; }
  .spinner { font-size: 48px; animation: spin 2s linear infinite; display: inline-block; }

  /* â”€â”€â”€ EMPTY â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .empty { text-align: center; padding: 60px 20px; color: var(--text3); }
  .empty-icon { font-size: 52px; margin-bottom: 14px; }

  /* â”€â”€â”€ RESPONSIVE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  @media (max-width: 600px) {
    header { flex-direction: column; align-items: flex-start; gap: 12px; padding: 14px 16px; }
    .header-right { align-items: flex-start; }
    nav button { padding: 5px 10px; font-size: 12px; }
    .container { padding: 20px 14px; }
    .score-num { font-size: 22px; }
  }

  /* â”€â”€â”€ AI PANEL â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  :root { --ai: #0d1a2a; --ai2: #2a4a6a; --ai-text: #7ab4e8; }
  .btn-ai { padding: 8px 18px; background: var(--ai); border: 1px solid var(--ai2); color: var(--ai-text); cursor: pointer; border-radius: 4px; font-family: 'Crimson Text', serif; font-size: 14px; transition: all 0.2s; white-space: nowrap; }
  .btn-ai:hover { background: var(--ai2); }
  .ai-panel { background: linear-gradient(135deg, #0d1a2a, #101e30); border: 1px solid var(--ai2); border-radius: 8px; padding: 20px; margin-bottom: 16px; animation: fadeUp 0.3s ease; }
  .ai-badge { font-size: 10px; letter-spacing: 3px; color: var(--ai-text); text-transform: uppercase; background: #1a3050; border: 1px solid var(--ai2); padding: 3px 10px; border-radius: 20px; display:inline-block; margin-bottom:10px; }
  .ai-loading { background: linear-gradient(90deg,#1a2a3a 25%,#2a4a6a 50%,#1a2a3a 75%); background-size:200% 100%; animation:shimmer 1.5s infinite; border-radius:4px; height:14px; margin-bottom:8px; }
  .ai-suggestion-row { display:flex; align-items:flex-start; gap:10px; padding:10px 0; border-bottom:1px solid #1a2a3a; }
  .ai-suggestion-row:last-child { border-bottom:none; }
  .ai-chef-name { color:var(--accent2); font-size:13px; width:100px; flex-shrink:0; padding-top:4px; }
  .ai-events { display:flex; flex-wrap:wrap; gap:5px; flex:1; }
  .ai-event-chip { padding:3px 10px; border-radius:20px; font-size:12px; border:1px solid var(--ai2); background:rgba(42,74,106,0.3); color:var(--ai-text); cursor:pointer; transition:all 0.15s; }
  .ai-event-chip.accepted { background:#0f2a0f; border-color:#1a4a1a; color:var(--green2); }
  .ai-event-chip.rejected { background:#1a0808; border-color:#3a1010; color:var(--text3); text-decoration:line-through; opacity:0.5; }
  /* â”€â”€â”€ SCORING SETTINGS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .scoring-rule-row { display:flex; align-items:center; gap:10px; margin-bottom:10px; }
  .scoring-rule-name { flex:1; color:var(--text); font-size:14px; }
  .scoring-rule-pts { width:70px; text-align:center; }
  .scoring-rule-delete { background:none; border:none; color:var(--text3); cursor:pointer; font-size:14px; padding:4px; }
  .scoring-rule-delete:hover { color:var(--red2); }
</style>
</head>
<body>

<!-- LOADING -->
<div id="loading-overlay" style="display:none;">
  <div class="spinner">ğŸ³</div>
  <div style="font-family:'Playfair Display',serif;color:#c47a3a;letter-spacing:3px;font-size:14px;">LOADING LEAGUE...</div>
</div>

<!-- MAIN APP -->
<div id="app">
  <header>
    <div class="logo-area">
      <div class="logo-eyebrow">Top Chef Season 23 Â· Charlotte</div>
      <div class="logo-title">ğŸ³ Fantasy League</div>
    </div>
    <div class="header-right">
      <nav>
        <button class="active" onclick="switchTab('leaderboard', this)">Leaderboard</button>
        <button onclick="switchTab('draft', this)">Draft</button>
        <button onclick="switchTab('episodes', this)">Episodes</button>
        <button onclick="switchTab('chefs', this)">Chefs</button>
        <button onclick="switchTab('settings', this)">âš™</button>
      </nav>
      <div class="sync-status" id="sync-status">â— CONNECTING...</div>
    </div>
  </header>

  <div class="container">

    <!-- â•â•â• LEADERBOARD â•â•â• -->
    <div id="tab-leaderboard" class="tab-content active">
      <div class="section-header">
        <div>
          <div class="section-title">Standings</div>
          <div class="section-sub" id="ep-count">0 episodes logged</div>
        </div>
        <div style="display:flex;gap:8px;flex-wrap:wrap;">
          <button class="btn-ghost btn-sm" onclick="showTextPanel()">ğŸ“± Weekly Text</button>
          <button class="btn btn-sm" onclick="toggleForm('add-player-form')">+ Add Player</button>
        </div>
      </div>

      <div id="add-player-form" class="inline-form" style="display:none;">
        <div class="form-title">New League Member</div>
        <div class="form-row">
          <input type="text" id="new-player-input" placeholder="Player name..." onkeydown="if(event.key==='Enter')addPlayer()">
          <button class="btn" onclick="addPlayer()">Add</button>
          <button class="btn-ghost" onclick="toggleForm('add-player-form')">Cancel</button>
        </div>
      </div>

      <!-- Weekly text panel -->
      <div id="text-panel" style="display:none;"></div>

      <div id="leaderboard-list">
        <div class="empty"><div class="empty-icon">ğŸ½ï¸</div><div>No players yet â€” add your first league member!</div></div>
      </div>
    </div>

    <!-- â•â•â• DRAFT â•â•â• -->
    <div id="tab-draft" class="tab-content">
      <div class="section-header">
        <div>
          <div class="section-title">Draft Picks</div>
          <div class="section-sub">Assign chefs to each player</div>
        </div>
      </div>
      <div id="draft-list">
        <div class="empty"><div class="empty-icon">ğŸ“‹</div><div>Add players in the Leaderboard tab first.</div></div>
      </div>
    </div>

    <!-- â•â•â• EPISODES â•â•â• -->
    <div id="tab-episodes" class="tab-content">
      <div class="section-header">
        <div>
          <div class="section-title">Episodes</div>
          <div class="section-sub">Scores update automatically</div>
        </div>
        <div style="display:flex;gap:8px;flex-wrap:wrap;">
          <button class="btn-ai btn-sm" onclick="startAiSuggestion()">âœ¦ AI Suggest Scores</button>
          <button class="btn btn-sm" onclick="toggleForm('add-episode-form')">+ Log Manually</button>
        </div>
      </div>
      <!-- AI Panel -->
      <div id="ai-panel" style="display:none;"></div>
      <!-- Manual Episode Form -->
      <div id="add-episode-form" class="inline-form" style="display:none;">
        <div class="form-title">Log New Episode</div>
        <input type="text" id="new-episode-input" placeholder="e.g. Episode 4 â€” Restaurant Wars" style="width:100%;margin-bottom:16px;">
        <div style="font-size:10px;letter-spacing:3px;color:var(--text3);text-transform:uppercase;margin-bottom:12px;">Mark events for each chef:</div>
        <div class="ep-events-scroll" id="episode-chef-events"></div>
        <div class="form-row" style="margin-top:16px;">
          <button class="btn" onclick="saveEpisode()">Save Episode</button>
          <button class="btn-ghost" onclick="cancelEpisode()">Cancel</button>
        </div>
      </div>
      <div id="episodes-list">
        <div class="empty"><div class="empty-icon">ğŸ“º</div><div>No episodes logged yet.</div></div>
      </div>
    </div>

    <!-- â•â•â• CHEFS â•â•â• -->
    <div id="tab-chefs" class="tab-content">
      <div class="section-header">
        <div>
          <div class="section-title">Chef Roster</div>
          <div class="section-sub" id="chef-counts">Loading...</div>
        </div>
      </div>
      <div class="chef-grid" id="chef-grid"></div>
    </div>

    <!-- â•â•â• SETTINGS â•â•â• -->
    <div id="tab-settings" class="tab-content">
      <div class="section-header">
        <div>
          <div class="section-title">Settings</div>
          <div class="section-sub">Manage your league configuration</div>
        </div>
      </div>

      <div class="card" style="margin-bottom:16px;">
        <div style="font-size:12px;letter-spacing:3px;color:var(--accent);text-transform:uppercase;margin-bottom:12px;">AI Scoring â€” Anthropic API Key</div>
        <p style="font-size:13px;color:var(--text3);margin-bottom:12px;line-height:1.6;">Powers the "âœ¦ AI Suggest Scores" button. Costs ~$0.01â€“0.03 per use. Get a key at <a href="https://console.anthropic.com" target="_blank" style="color:var(--accent);">console.anthropic.com</a> (requires $5 min deposit).</p>
        <div class="form-row">
          <input type="password" id="settings-api-key" placeholder="sk-ant-..." style="flex:1;">
          <button class="btn" onclick="saveApiKey()">Save</button>
        </div>
        <div id="api-key-status" style="font-size:12px;color:var(--text3);margin-top:8px;"></div>
      </div>

      <div class="card" style="margin-bottom:16px;">
        <div style="font-size:12px;letter-spacing:3px;color:var(--accent);text-transform:uppercase;margin-bottom:12px;">Scoring Rules</div>
        <p style="font-size:13px;color:var(--text3);margin-bottom:14px;line-height:1.6;">Adjust point values or add custom events. Changes apply to all future scoring. Existing episode scores are recalculated automatically.</p>
        <div id="scoring-rules-list"></div>
        <div style="margin-top:14px;padding-top:14px;border-top:1px solid var(--border);">
          <div style="font-size:11px;letter-spacing:2px;color:var(--text3);text-transform:uppercase;margin-bottom:10px;">Add Custom Event</div>
          <div class="form-row">
            <input type="text" id="new-event-name" placeholder="Event name (e.g. Won LCK Duel)" style="flex:2;">
            <input type="text" id="new-event-pts" placeholder="Pts (e.g. 2)" style="flex:0.6;min-width:60px;">
            <button class="btn" onclick="addCustomEvent()">Add</button>
          </div>
        </div>
      </div>

      <div class="card" style="margin-bottom:16px;">
        <div style="font-size:12px;letter-spacing:3px;color:var(--accent);text-transform:uppercase;margin-bottom:12px;">League Members & Phone Numbers</div>
        <p style="font-size:13px;color:var(--text3);margin-bottom:14px;line-height:1.6;">Add phone numbers for the weekly leaderboard text.</p>
        <div id="member-phones-list"></div>
      </div>

      <div class="card">
        <div style="font-size:12px;letter-spacing:3px;color:var(--red2);text-transform:uppercase;margin-bottom:12px;">Danger Zone</div>
        <button class="btn-ghost" onclick="resetLeague()" style="border-color:var(--red);color:var(--red2);">Reset All League Data</button>
      </div>
    </div>

  </div><!-- /container -->
</div><!-- /app -->

<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore-compat.js"></script>
<script>
// â”€â”€â”€ CONSTANTS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const CHEFS = [
  "Sieger Bayer","Jassi Bindra","Sherry Cardoso","Brittany Cochran",
  "Brandon Dearden","Jonathan Dearden","Oscar Diaz","Duyen Ha",
  "Jennifer Lee Jackson","Anthony Jones","Day Joseph",
  "Laurence Louie","Rhoda Magbitang","Justin Tootla","Nana Araba Wilmot"
];

const DEFAULT_SCORING = {
  "Won Quickfire": 3,
  "Won Elimination": 5,
  "Top Dishes": 2,
  "Last Chance Kitchen Win": 2,
  "Eliminated": -3,
  "Fan Favorite": 4,
};

const MEDALS = ["ğŸ¥‡","ğŸ¥ˆ","ğŸ¥‰"];
const API_KEY_KEY = "tcfl_anthropic_key";
const PHONES_KEY  = "tcfl_member_phones";

let db = null;
let state = {
  players: [],
  chefStatus: Object.fromEntries(CHEFS.map(c => [c, "active"])),
  episodes: [],
  chefRoster: [...CHEFS],
  scoring: { ...DEFAULT_SCORING },
};

let pendingEpisodeEvents = {};
let editingPlayerId = null;
let aiSuggestions = null;

// â”€â”€â”€ HELPERS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function getApiKey() { try { return localStorage.getItem(API_KEY_KEY) || ""; } catch { return ""; } }
function saveApiKeyLocal(k) { try { localStorage.setItem(API_KEY_KEY, k); } catch {} }
function getPhones() { try { return JSON.parse(localStorage.getItem(PHONES_KEY) || "{}"); } catch { return {}; } }
function savePhones(p) { try { localStorage.setItem(PHONES_KEY, JSON.stringify(p)); } catch {} }
function getScoring() { return state.scoring || DEFAULT_SCORING; }
function esc(str) { return String(str).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;"); }
function getRoster() { return state.chefRoster || CHEFS; }

// â”€â”€â”€ FIREBASE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function initFirebase(cfg) {
  document.getElementById("loading-overlay").style.display = "flex";
  try {
    const app = firebase.initializeApp(cfg);
    db = firebase.firestore();
    const ref = db.collection("league").doc("data");
    const snap = await ref.get();
    if (!snap.exists) await ref.set(state);

    ref.onSnapshot(snap => {
      if (snap.exists) {
        const data = snap.data();
        // Merge scoring defaults with any saved scoring
        if (!data.scoring) data.scoring = { ...DEFAULT_SCORING };
        state = data;
        renderAll();
      }
      setSyncStatus("ok");
    }, () => setSyncStatus("error"));

    document.getElementById("loading-overlay").style.display = "none";
    document.getElementById("app").style.display = "block";
    renderAll();
  } catch(e) {
    console.error(e);
    document.getElementById("loading-overlay").innerHTML =
      '<div style="color:#c44;font-family:serif;text-align:center;padding:40px;">Could not connect to Firebase.<br>Check your internet connection and try again.</div>';
  }
}

async function saveState() {
  if (!db) return;
  setSyncStatus("syncing");
  try { await db.collection("league").doc("data").set(state); setSyncStatus("ok"); }
  catch(e) { setSyncStatus("error"); console.error(e); }
}

function setSyncStatus(s) {
  const el = document.getElementById("sync-status");
  if (!el) return;
  el.className = "sync-status " + s;
  el.textContent = s === "syncing" ? "âŸ³ SYNCING..." : s === "ok" ? "âœ“ LIVE" : "âš  SYNC ERROR";
}

// â”€â”€â”€ TABS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
window.switchTab = function(name, btn) {
  document.querySelectorAll(".tab-content").forEach(t => t.classList.remove("active"));
  document.querySelectorAll("nav button").forEach(b => b.classList.remove("active"));
  document.getElementById("tab-" + name).classList.add("active");
  btn.classList.add("active");
  if (name === "settings") renderSettings();
};

window.toggleForm = function(id) {
  const el = document.getElementById(id);
  const showing = el.style.display !== "none";
  el.style.display = showing ? "none" : "block";
  if (!showing && id === "add-episode-form") renderEpisodeChefList();
  if (!showing && id === "add-player-form") setTimeout(() => document.getElementById("new-player-input").focus(), 50);
};

// â”€â”€â”€ SCORING â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function computeScores() {
  const scoring = getScoring();
  return state.players.map(p => {
    let total = 0;
    (state.episodes || []).forEach(ep => {
      (p.picks || []).forEach(chef => {
        ((ep.events || {})[chef] || []).forEach(ev => { total += scoring[ev] || 0; });
      });
    });
    return { ...p, total };
  }).sort((a, b) => b.total - a.total);
}

// â”€â”€â”€ RENDER ALL â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderAll() {
  renderLeaderboard();
  renderDraft();
  renderEpisodes();
  renderChefs();
}

// â”€â”€â”€ LEADERBOARD â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderLeaderboard() {
  const ranked = computeScores();
  const list = document.getElementById("leaderboard-list");
  const epCount = document.getElementById("ep-count");
  if (epCount) epCount.textContent = `${(state.episodes||[]).length} episode${(state.episodes||[]).length !== 1 ? "s" : ""} logged`;

  if (!ranked.length) {
    list.innerHTML = `<div class="empty"><div class="empty-icon">ğŸ½ï¸</div><div>No players yet â€” add your first league member!</div></div>`;
    return;
  }
  list.innerHTML = ranked.map((p, i) => {
    const cls = p.total > 0 ? "positive" : p.total < 0 ? "negative" : "zero";
    const str = p.total > 0 ? `+${p.total}` : `${p.total}`;
    return `<div class="player-row${i===0?" card gold-border":""}">
      <div class="player-rank">${MEDALS[i] || "#"+(i+1)}</div>
      <div class="player-info">
        <div class="player-name">${esc(p.name)}</div>
        <div class="player-picks-preview">${(p.picks||[]).length ? "Picks: " + p.picks.join(", ") : "No picks yet"}</div>
      </div>
      <div class="player-score">
        <div class="score-num ${cls}">${str}</div>
        <div class="score-label">PTS</div>
      </div>
      <button class="btn-icon" onclick="deletePlayer('${p.id}')">âœ•</button>
    </div>`;
  }).join("");
}

window.addPlayer = function() {
  const input = document.getElementById("new-player-input");
  const name = input.value.trim();
  if (!name) return;
  state.players = [...(state.players||[]), { id: Date.now().toString(), name, picks: [] }];
  saveState();
  input.value = "";
  document.getElementById("add-player-form").style.display = "none";
};

window.deletePlayer = function(id) {
  if (!confirm("Remove this player?")) return;
  state.players = state.players.filter(p => p.id !== id);
  saveState();
};

// â”€â”€â”€ WEEKLY TEXT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
window.showTextPanel = function() {
  const panel = document.getElementById("text-panel");
  if (panel.style.display !== "none") { panel.style.display = "none"; return; }
  const ranked = computeScores();
  if (!ranked.length) { alert("No players yet!"); return; }
  const epNum = (state.episodes||[]).length;
  const lines = [
    `ğŸ³ Top Chef S23 Fantasy â€” Week ${epNum} Standings`, ``,
    ...ranked.map((p, i) => `${MEDALS[i] || (i+1)+"."} ${p.name}: ${p.total > 0 ? "+"+p.total : p.total} pts`),
    ``, `See you next week! ğŸ‘¨â€ğŸ³`
  ].join("\n");

  panel.style.display = "block";
  panel.innerHTML = `<div class="text-panel">
    <div class="text-panel-header">
      <span class="text-badge">ğŸ“± Weekly Text</span>
      <button class="btn-icon" onclick="document.getElementById('text-panel').style.display='none'">âœ•</button>
    </div>
    <div class="text-preview" id="text-preview">${esc(lines)}</div>
    <div style="display:flex;gap:10px;margin-top:12px;flex-wrap:wrap;">
      <button class="copy-btn" id="copy-text-btn" onclick="copyLeaderboardText()">ğŸ“‹ Copy to Clipboard</button>
    </div>
  </div>`;
};

window.copyLeaderboardText = function() {
  const text = document.getElementById("text-preview").textContent;
  navigator.clipboard.writeText(text).then(() => {
    const btn = document.getElementById("copy-text-btn");
    btn.textContent = "âœ“ Copied!"; btn.classList.add("copied");
    setTimeout(() => { btn.textContent = "ğŸ“‹ Copy to Clipboard"; btn.classList.remove("copied"); }, 2500);
  }).catch(() => {
    const ta = document.createElement("textarea");
    ta.value = text; document.body.appendChild(ta); ta.select();
    document.execCommand("copy"); document.body.removeChild(ta);
  });
};

// â”€â”€â”€ DRAFT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderDraft() {
  const list = document.getElementById("draft-list");
  if (!(state.players||[]).length) {
    list.innerHTML = `<div class="empty"><div class="empty-icon">ğŸ“‹</div><div>Add players in the Leaderboard tab first.</div></div>`;
    return;
  }
  list.innerHTML = state.players.map(player => {
    const isEditing = editingPlayerId === player.id;
    const pickTags = (player.picks||[]).length
      ? player.picks.map(c => `<span class="pick-tag">${esc(c)}</span>`).join("")
      : `<span style="color:var(--text3);font-size:13px;">No picks yet</span>`;
    const chipsHtml = isEditing ? getRoster().map(chef => {
      const picked = (player.picks||[]).includes(chef);
      const elim = (state.chefStatus||{})[chef] === "eliminated";
      return `<button class="chip ${picked?"selected":""} ${elim?"eliminated":""}" ${elim?"disabled":""}
        onclick="togglePick('${player.id}','${esc(chef)}')">${esc(chef)}</button>`;
    }).join("") : "";
    return `<div class="card" style="margin-bottom:12px;">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:${isEditing?12:8}px;">
        <div style="font-size:16px;color:var(--text);">${esc(player.name)}</div>
        <button class="btn btn-sm" onclick="setEditingPlayer('${player.id}')">${isEditing?"âœ“ Done":"Edit Picks"}</button>
      </div>
      ${isEditing
        ? `<div style="font-size:10px;letter-spacing:3px;color:var(--text3);text-transform:uppercase;margin-bottom:10px;">Click to toggle picks</div><div class="chips">${chipsHtml}</div>`
        : `<div>${pickTags}</div>`}
    </div>`;
  }).join("");
}

window.setEditingPlayer = function(id) {
  editingPlayerId = editingPlayerId === id ? null : id;
  renderDraft();
};

window.togglePick = function(playerId, chef) {
  state.players = state.players.map(p => {
    if (p.id !== playerId) return p;
    const picks = (p.picks||[]).includes(chef) ? p.picks.filter(c => c !== chef) : [...(p.picks||[]), chef];
    return { ...p, picks };
  });
  saveState();
};

// â”€â”€â”€ AI SCORING â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
window.startAiSuggestion = async function() {
  const apiKey = getApiKey();
  const panel = document.getElementById("ai-panel");

  if (!apiKey) {
    panel.style.display = "block";
    panel.innerHTML = `<div class="ai-panel">
      <span class="ai-badge">âœ¦ AI</span>
      <p style="font-size:14px;color:var(--text3);margin:8px 0 14px;line-height:1.7;">Add your Anthropic API key in <strong style="color:var(--accent);">Settings âš™</strong> to use AI scoring suggestions.</p>
      <button class="btn-ghost btn-sm" onclick="document.getElementById('ai-panel').style.display='none'">Dismiss</button>
    </div>`;
    return;
  }

  const epNum = (state.episodes||[]).length + 1;
  const activeChefs = getRoster().filter(c => (state.chefStatus||{})[c] !== "eliminated");
  const scoringKeys = Object.keys(getScoring());

  panel.style.display = "block";
  panel.innerHTML = `<div class="ai-panel">
    <span class="ai-badge">âœ¦ AI â€” Searching...</span>
    <div class="ai-loading" style="width:80%;margin-top:12px;"></div>
    <div class="ai-loading" style="width:60%;"></div>
    <div class="ai-loading" style="width:70%;"></div>
    <p style="font-size:12px;color:var(--text3);margin-top:12px;font-style:italic;">Looking up Top Chef Season 23 Episode ${epNum} results...</p>
  </div>`;
  panel.scrollIntoView({ behavior: "smooth", block: "nearest" });

  try {
    const prompt = `You are helping score Episode ${epNum} of Top Chef Season 23 (Charlotte, NC, on Bravo).

Active chefs still competing: ${activeChefs.join(", ")}.
Previous episodes logged: ${(state.episodes||[]).map(e=>e.name).join(", ")||"none yet"}.

Search the web for the results of the most recently aired episode of Top Chef Season 23. Then for each chef, list which of these scoring events occurred: ${scoringKeys.join(", ")}.

Only include chefs where something notable happened. Respond ONLY with a JSON object, no other text:
{
  "episodeName": "Episode X â€” Title",
  "aired": true,
  "source": "brief source",
  "note": "any caveats",
  "results": [
    {"chef": "Chef Name", "events": ["Won Quickfire"]},
    {"chef": "Chef Name", "events": ["Eliminated"]}
  ]
}`;

    const response = await fetch("https://api.anthropic.com/v1/messages", {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
        "x-api-key": apiKey,
        "anthropic-version": "2023-06-01",
      },
      body: JSON.stringify({
        model: "claude-sonnet-4-20250514",
        max_tokens: 1500,
        tools: [{ type: "web_search_20250305", name: "web_search" }],
        messages: [{ role: "user", content: prompt }]
      })
    });

    const data = await response.json();
    if (data.error) throw new Error(data.error.message);

    const fullText = (data.content||[]).filter(b=>b.type==="text").map(b=>b.text).join("\n");
    let parsed;
    try {
      const m = fullText.match(/\{[\s\S]*\}/);
      parsed = JSON.parse(m ? m[0] : fullText);
    } catch { throw new Error("Could not parse response. Please try again."); }

    aiSuggestions = {
      episodeName: parsed.episodeName || `Episode ${epNum}`,
      source: parsed.source || "",
      note: parsed.note || "",
      aired: parsed.aired !== false,
      items: (parsed.results||[]).map(r => ({
        chef: r.chef,
        events: r.events||[],
        states: Object.fromEntries((r.events||[]).map(ev => [ev, true]))
      }))
    };
    renderAiPanel();

  } catch(err) {
    panel.innerHTML = `<div class="ai-panel">
      <span class="ai-badge">âœ¦ AI â€” Error</span>
      <p style="font-size:14px;color:var(--red2);margin:10px 0 14px;">${esc(err.message)}</p>
      <div style="display:flex;gap:10px;">
        <button class="btn-ai btn-sm" onclick="startAiSuggestion()">Try Again</button>
        <button class="btn-ghost btn-sm" onclick="document.getElementById('ai-panel').style.display='none'">Dismiss</button>
      </div>
    </div>`;
  }
};

function renderAiPanel() {
  const panel = document.getElementById("ai-panel");
  const s = aiSuggestions;
  if (!s) return;
  const scoring = getScoring();

  const rowsHtml = s.items.map((item, idx) => {
    const chips = item.events.map(ev => {
      const on = item.states[ev];
      const pts = scoring[ev] || 0;
      return `<button class="ai-event-chip ${on?"accepted":"rejected"}" onclick="toggleAiEvent(${idx},'${esc(ev)}')">
        ${on?"âœ“":"âœ•"} ${esc(ev)} <span style="opacity:0.6;font-size:11px;">(${pts>0?"+":""}${pts})</span>
      </button>`;
    }).join("");
    return `<div class="ai-suggestion-row">
      <div class="ai-chef-name">${esc(item.chef)}</div>
      <div class="ai-events">${chips}</div>
    </div>`;
  }).join("");

  panel.innerHTML = `<div class="ai-panel">
    <div style="display:flex;align-items:center;gap:10px;margin-bottom:12px;">
      <span class="ai-badge">âœ¦ AI Suggestion</span>
      <span style="font-size:15px;color:var(--text);">${esc(s.episodeName)}</span>
    </div>
    ${!s.aired ? `<div style="background:#1a1000;border:1px solid #3a2a00;border-radius:6px;padding:10px 14px;margin-bottom:14px;font-size:13px;color:#c8a040;">âš  This episode may not have aired yet. Please verify before confirming.</div>` : ""}
    <p style="font-size:13px;color:var(--text3);margin-bottom:14px;">Click any event to toggle it on (âœ“) or off (âœ•) before saving.</p>
    ${rowsHtml || `<p style="color:var(--text3);font-size:14px;">No notable results found.</p>`}
    ${s.note ? `<p style="font-size:12px;color:var(--text3);margin-top:12px;font-style:italic;">ğŸ“ ${esc(s.note)}</p>` : ""}
    ${s.source ? `<p style="font-size:11px;color:#3a5a7a;margin-top:4px;">Source: ${esc(s.source)}</p>` : ""}
    <div style="display:flex;gap:10px;margin-top:16px;flex-wrap:wrap;">
      <button class="btn" onclick="confirmAiSuggestion()">âœ“ Confirm & Save to Leaderboard</button>
      <button class="btn-ghost" onclick="document.getElementById('ai-panel').style.display='none';aiSuggestions=null;">Discard</button>
    </div>
  </div>`;
}

window.toggleAiEvent = function(idx, ev) {
  if (!aiSuggestions) return;
  aiSuggestions.items[idx].states[ev] = !aiSuggestions.items[idx].states[ev];
  renderAiPanel();
};

window.confirmAiSuggestion = function() {
  if (!aiSuggestions) return;
  const events = {};
  aiSuggestions.items.forEach(item => {
    const accepted = item.events.filter(ev => item.states[ev]);
    if (accepted.length) events[item.chef] = accepted;
  });
  state.episodes = [...(state.episodes||[]), {
    id: Date.now().toString(),
    name: aiSuggestions.episodeName,
    events
  }];
  saveState();
  document.getElementById("ai-panel").style.display = "none";
  aiSuggestions = null;
  document.querySelector("nav button").click();
};

// â”€â”€â”€ EPISODES (MANUAL) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderEpisodeChefList() {
  pendingEpisodeEvents = {};
  const scoring = getScoring();
  const activeChefs = getRoster().filter(c => (state.chefStatus||{})[c] !== "eliminated");
  document.getElementById("episode-chef-events").innerHTML = activeChefs.map(chef => `
    <div class="ep-chef-row">
      <div class="ep-chef-name">${esc(chef)}</div>
      <div class="event-grid">
        ${Object.entries(scoring).map(([ev, pts]) =>
          `<button class="event-btn" onclick="toggleEpisodeEvent(this,'${esc(chef)}','${esc(ev)}')">
            ${esc(ev)} <span class="${pts>0?"event-pts-pos":"event-pts-neg"}">(${pts>0?"+":""}${pts})</span>
          </button>`).join("")}
      </div>
    </div>`).join("");
}

window.toggleEpisodeEvent = function(btn, chef, ev) {
  if (!pendingEpisodeEvents[chef]) pendingEpisodeEvents[chef] = [];
  const idx = pendingEpisodeEvents[chef].indexOf(ev);
  if (idx >= 0) { pendingEpisodeEvents[chef].splice(idx,1); btn.classList.remove("active"); }
  else { pendingEpisodeEvents[chef].push(ev); btn.classList.add("active"); }
};

window.saveEpisode = function() {
  const name = document.getElementById("new-episode-input").value.trim();
  if (!name) { alert("Please enter an episode name."); return; }
  state.episodes = [...(state.episodes||[]), { id: Date.now().toString(), name, events: {...pendingEpisodeEvents} }];
  saveState();
  document.getElementById("new-episode-input").value = "";
  document.getElementById("add-episode-form").style.display = "none";
  pendingEpisodeEvents = {};
};

window.cancelEpisode = function() {
  document.getElementById("add-episode-form").style.display = "none";
  pendingEpisodeEvents = {};
};

function renderEpisodes() {
  const scoring = getScoring();
  const list = document.getElementById("episodes-list");
  const eps = [...(state.episodes||[])].reverse();
  if (!eps.length) {
    list.innerHTML = `<div class="empty"><div class="empty-icon">ğŸ“º</div><div>No episodes logged yet.</div></div>`;
    return;
  }
  list.innerHTML = eps.map(ep => {
    const rows = Object.entries(ep.events||{}).filter(([,evs])=>evs.length).map(([chef,evs])=>
      `<div style="display:flex;align-items:center;gap:10px;margin-bottom:8px;">
        <span style="color:var(--accent2);width:110px;font-size:12px;flex-shrink:0;">${esc(chef)}</span>
        <div>${evs.map(ev=>`<span class="event-tag ${(scoring[ev]||0)>0?"pos":"neg"}">${esc(ev)}</span>`).join(" ")}</div>
      </div>`).join("");
    return `<div class="card" style="margin-bottom:12px;">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:${rows?12:0}px;">
        <div style="font-size:15px;color:var(--text);">${esc(ep.name)}</div>
        <button class="btn-icon" onclick="deleteEpisode('${ep.id}')">âœ•</button>
      </div>
      ${rows || `<div style="font-size:12px;color:var(--text3);">No events recorded</div>`}
    </div>`;
  }).join("");
}

window.deleteEpisode = function(id) {
  if (!confirm("Delete this episode? Scores will be recalculated.")) return;
  state.episodes = state.episodes.filter(e => e.id !== id);
  saveState();
};

// â”€â”€â”€ CHEFS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderChefs() {
  const roster = getRoster();
  const active = roster.filter(c => (state.chefStatus||{})[c] !== "eliminated").length;
  document.getElementById("chef-counts").textContent = `${active} active Â· ${roster.length - active} eliminated`;
  document.getElementById("chef-grid").innerHTML = roster.map(chef => {
    const elim = (state.chefStatus||{})[chef] === "eliminated";
    return `<div class="chef-card ${elim?"eliminated":""}">
      <div class="chef-emoji">${elim?"âŒ":"ğŸ‘¨â€ğŸ³"}</div>
      <div class="chef-name">${esc(chef)}</div>
      <button style="padding:3px 10px;font-size:10px;border-radius:4px;border:1px solid var(--border2);background:transparent;color:${elim?"var(--text3)":"var(--red2)"};cursor:${elim?"default":"pointer"};letter-spacing:1px;font-family:'Crimson Text',serif;"
        ${elim?"disabled":""} onclick="${elim?"":"eliminateChef('"+esc(chef)+"')"}">${elim?"OUT":"ELIMINATE"}</button>
    </div>`;
  }).join("");
}

window.eliminateChef = function(chef) {
  if (!confirm(`Eliminate ${chef}?`)) return;
  state.chefStatus = { ...(state.chefStatus||{}), [chef]: "eliminated" };
  saveState();
};

// â”€â”€â”€ SETTINGS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderSettings() {
  const key = getApiKey();
  const phones = getPhones();
  const keyInput = document.getElementById("settings-api-key");
  if (keyInput && key) keyInput.value = key;
  const keyStatus = document.getElementById("api-key-status");
  if (keyStatus && key) { keyStatus.textContent = "âœ“ API key saved"; keyStatus.style.color = "var(--green2)"; }

  // Scoring rules
  const scoring = getScoring();
  const scoreList = document.getElementById("scoring-rules-list");
  if (scoreList) {
    scoreList.innerHTML = Object.entries(scoring).map(([ev, pts]) => `
      <div class="scoring-rule-row">
        <div class="scoring-rule-name">${esc(ev)}</div>
        <input type="text" class="scoring-rule-pts" value="${pts}"
          style="width:70px;text-align:center;padding:6px 8px;"
          onchange="updateScoringRule('${esc(ev)}', this.value)">
        <button class="scoring-rule-delete" onclick="deleteScoringRule('${esc(ev)}')" title="Delete event">âœ•</button>
      </div>`).join("");
  }

  // Phone numbers
  const phoneList = document.getElementById("member-phones-list");
  if (phoneList) {
    phoneList.innerHTML = (state.players||[]).length
      ? state.players.map(p => `
          <div style="display:flex;align-items:center;gap:10px;margin-bottom:10px;">
            <div style="width:130px;color:var(--text);font-size:14px;flex-shrink:0;">${esc(p.name)}</div>
            <input type="text" placeholder="+1 555 000 0000" value="${esc(phones[p.id]||"")}"
              style="flex:1;" oninput="savePhoneFor('${p.id}',this.value)">
          </div>`).join("")
      : `<p style="color:var(--text3);font-size:13px;">No players yet.</p>`;
  }
}

window.saveApiKey = function() {
  const k = document.getElementById("settings-api-key").value.trim();
  saveApiKeyLocal(k);
  const status = document.getElementById("api-key-status");
  status.textContent = k ? "âœ“ API key saved" : "Key cleared.";
  status.style.color = k ? "var(--green2)" : "var(--text3)";
};

window.updateScoringRule = function(ev, val) {
  const pts = parseInt(val, 10);
  if (isNaN(pts)) return;
  if (!state.scoring) state.scoring = { ...DEFAULT_SCORING };
  state.scoring[ev] = pts;
  saveState();
};

window.deleteScoringRule = function(ev) {
  if (!confirm(`Remove the "${ev}" scoring event? This will affect all existing episode scores.`)) return;
  if (!state.scoring) state.scoring = { ...DEFAULT_SCORING };
  delete state.scoring[ev];
  saveState();
  renderSettings();
};

window.addCustomEvent = function() {
  const nameEl = document.getElementById("new-event-name");
  const ptsEl  = document.getElementById("new-event-pts");
  const name = nameEl.value.trim();
  const pts  = parseInt(ptsEl.value.trim(), 10);
  if (!name) { alert("Please enter an event name."); return; }
  if (isNaN(pts)) { alert("Please enter a valid point value (e.g. 2 or -2)."); return; }
  if (!state.scoring) state.scoring = { ...DEFAULT_SCORING };
  state.scoring[name] = pts;
  saveState();
  nameEl.value = ""; ptsEl.value = "";
  renderSettings();
};

window.savePhoneFor = function(playerId, phone) {
  const phones = getPhones();
  phones[playerId] = phone.trim();
  savePhones(phones);
};

window.resetLeague = function() {
  if (!confirm("Reset ALL league data? This cannot be undone.")) return;
  if (!confirm("Are you absolutely sure?")) return;
  state = { players: [], chefStatus: Object.fromEntries(getRoster().map(c=>[c,"active"])), episodes: [], chefRoster:[...CHEFS], scoring:{...DEFAULT_SCORING} };
  saveState();
};

// â”€â”€â”€ BOOT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
(function boot() {
  const cfg = {
    apiKey: "AIzaSyA57MYW3CMpMzLkYtcI45bfmTpJ96wt61Q",
    authDomain: "top-shelf-top-chef-bcc59.firebaseapp.com",
    projectId: "top-shelf-top-chef-bcc59",
    storageBucket: "top-shelf-top-chef-bcc59.firebasestorage.app",
    messagingSenderId: "738146575304",
    appId: "1:738146575304:web:91c08e6aaa78aa5fa4d6fd"
  };
  initFirebase(cfg);
})();
</script>
</body>
</html>
